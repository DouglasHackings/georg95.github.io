<!doctype html>
<meta charset="utf-8"/>
<html>
<head>
<title>test</title>
	
</head>
	<body onload="start()">
		<canvas width="640" height="480" id="game"></canvas>
<script>
"use strict"
var canvas = document.getElementById('game');
var area = canvas.getContext("2d");
var bgimg = new Image();
bgimg.src="bg.png";
var trolleyimg = new Image();
trolleyimg.src="trolley.png";
var handimg = new Image();
handimg.src="hand.png";
var dynamiteimg = new Image();
dynamiteimg.src="dynamite.png";
var manimg = new Image();
manimg.src="man.png";
var man = {sizex:150/2, sizey:200/2,handangle:0};
man.draw = function(x,y,left)
    {
    area.translate(x, y);
    if(left) { area.scale(-1,1); }
    area.drawImage(manimg, -this.sizex/2, -this.sizey, this.sizex, this.sizey);
    area.setTransform(1, 0, 0, 1, 0, 0);
    }
man.drawhand = function(x,y,left)
    {
    var handx = x;
    var handy = y-this.sizey/3;
    area.translate(handx, handy);
    if(left) { area.scale(-1,1); }
    area.rotate(this.handangle);
    area.drawImage(handimg, -50/4, -50/4, 180/2, 50/2);
    area.setTransform(1, 0, 0, 1, 0, 0);
    }
man.update=function()
    {
    this.handangle-=0.1;
    }
var trolley = {x:300,y:200,vx:0,vy:0,sizex:300/2,sizey:200/2};
trolley.update=function()
    {
    this.x+=this.vx;
    this.y+=this.vy;
    if(this.x<0){this.x=0; this.vx=-this.vx;}
    if(this.y<0){this.y=0; this.vy=-this.vy;}
    if(this.x>canvas.width) {this.x=canvas.width;  this.vx=-this.vx;}
    if(this.y>canvas.height){this.y=canvas.height; this.vy=-this.vy;}
    man.update();
    }
trolley.draw=function()
    {
    var flip=this.vx>0?false:true;
    man.draw(this.x, this.y-this.sizey/3, flip);
    man.drawhand(this.x, this.y-this.sizey/3, flip);
    area.drawImage(trolleyimg, this.x-this.sizex/2, this.y-this.sizey/2,this.sizex,this.sizey);
    }
function drawBg(dx)
    {
    var dxs = Math.floor(dx/canvas.width*800);
    if(dx != canvas.width) area.drawImage(bgimg,dxs,0,800-dxs, 600, 0,0, canvas.width-dx,canvas.height);
    if(dx != 0) area.drawImage(bgimg,0,0,dxs, 600, canvas.width-dx,0, dx,canvas.height);
    }
var dx=0;
function DrawLoop()
    {
    //area.fillStyle="#FFF";
    dx-=2;
    if(dx < 0) { dx+=canvas.width; }
    if(dx >= canvas.width) { dx-=canvas.width; }
    drawBg(dx);
    trolley.update();
    trolley.draw();
    window.requestAnimationFrame(DrawLoop);
    }
    
function start()
    {
    (function() {
      var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame ||
                                  window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
      window.requestAnimationFrame = requestAnimationFrame;
    })();
    window.requestAnimationFrame(DrawLoop);
    }
</script>
    </body>
</html>
